양방향 LSTM 과 CRF (Bidirectional LSTM + CRF)

이번 챕터에서는 기존의 양방향 LSTM 모델에 CRF(Conditional Random Field)라는 새로운 층을 추가하여 보다 모델을 개선시킨
양방향 LSTM + CRF 모델을 사용하여 개체명 인식(Named Entity Recognition) 을 수행합니다.

1. CRF (Conditional Random Field)
CRF는 Conditional Random Field의 약자로 양방향 LSTM 을 위해 탄생한 모델이 아니라 이전에 독자적으로 존재해왔던 모델입니다.
이를 양방향 LSTM 모델 위에 하나의 층으로 추가하여, 양방향 LSTM + CRF 모델이 탄생하였습니다.
여기서는 CRF의 수식적 이해가 아니라 양방향 LSTM + CRF 모델의 직관에 대해서 이해합니다.

CRF 층의 역할을 이해하기 위해서 간단한 개체명 인식 작업의 예를 들어보겠습니다.
사람(Person), 조직(Organization) 두 가지만을 태깅하는 간단한 태깅 작업에 BIO 표현을 사용한다면 여기서 사용하는 태깅의 종류는 아래의 5가지입니다.

B-per, I-per, B-Org, I-Org, O

-> 개체명 인식에서 코퍼스로부터 개체명을 인식하기 위한 방법으로는 여러 방법이 있지만, 여기서는 가장 보편적인 방법 중 하나인 BIO 방법을 소개한다.
-> B 는 Begin의 약자로 개체명이 시작되는 부분
-> I 는 Inside의 약자로 개체명의 내부 부분을 의미
-> O 는 Outside의 약자로 개체명이 아닌 부분을 의미

-> 예를 들어, 영화에 대한 코퍼스 중에서 영화 제목에 대한 개체명을 뽑아내고 싶다고 가정하자
-> 해리포터 보러가자
-> B I I I  O O O O

Bi-LSTM 모델
위 모델은 각 단어를 벡터로 입력받고, 모델의 출력층에서 활성화 함수를 통해 개체명을 예측합니다.
사실 입력 단어들과 실제 개체명이 무엇인지 모르는 상황이므로 이 모델이 정확하게 개체명을 예측했는지는 위 그림만으로는 알 수 없습니다.

Bi-LSTM 위에 CRF 층을 추가하여 얻을 수 있는 이점을 언급하겠습니다.
CRF 층을 추가하면 모델은 예측 개체명, 다시 말해 레이블 사이의 의존성을 고려할 수 있습니다. 

기존에 CRF 층이 존재하지 않았던 양방향 LSTM 모델은 활성화 함수를 지난 시점에서 개체명을 결정했지만,
CRF 층을 추가한 모델에서는 활성화 함수의 결과들이 CRF 층의 입력으로 전달됩니다.
모든 단어에 대한 활성화 함수를 지난 출력값은 CRF 층의 입력이 되고, CRF 층은 레이블 시퀀스에 대해서 가장 높은 점수를 가지는 시퀀스를 예측합니다.
양방향 LSTM은 "입력 단어"에 대한 양방향 문맥을 반영하며, CRF는 "출력 레이블"에 대한 양방향 문맥을 반영합니다.
